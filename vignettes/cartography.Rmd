---
title: 'cartography'
author: "Timothée Giraud, Nicolas Lambert"
date: '`r Sys.Date()`'
output: 
  rmarkdown::html_vignette:
    toc: true
    number_sections: true 
    toc_depth: 1
vignette: >
  %\VignetteIndexEntry{cartography}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>", 
  fig.path="./fig/", 
  fig.width = 5, 
  fig.height = 6
)
```

# Introduction

The aim of `cartography` is to obtain thematic maps with the visual quality of those build with a classical mapping or GIS software.

Users of the package could belong to one of two categories: cartographers willing to use R or R users willing to create maps. Therefore, its functions have to be intuitive to cartographers and ensure compatibility with common R workflows.

`cartography` uses [`sf`](https://CRAN.R-project.org/package=sf) objects to produce `base` graphics.  

`cartography` functions can be classified in the following categories :

-   **Symbology**\
    Each function focuses on a single cartographic representation (e.g. proportional symbols or choropleth representation) and displays it on a georeferenced plot. This solution allows to consider each representation as a layer and to overlay multiple representations on a same map. Functions names start with `tc_map_` and each function has two main arguments that are:

    -   `x`, an `sf` object),
    -   `var`, the name(s) of a variable(s) to map.

    Many parameters are available to fine tune the cartographic representations. These parameters are the common ones found in GIS and automatic cartography tools (e.g. classification and color palettes used in choropleth maps, symbols sizes used in proportional symbols maps...).

-   **Transformations**\
    A set of functions is dedicated to the creation or transformation of spatial objects (e.g. borders extraction, grid or links creation). These functions are provided to ease the creation of some more advanced maps that usually need geo-processing. Functions name start with `tc_get_`.

-   **Map Layout**\
    Along with the cartographic functions, some other functions are dedicated to layout design (e.g. customizable scale bar, north arrow, title, sources or author information...).

-   **Legends**\
    Legends are displayed by default along cartographic layers but more parameters are available through `tc_leg_*()` functions.

# Main Features

## Symbology

+------------------------------+---------------+------------------+----------------------+-----------------------+---------------------+---------------------------+
| map type                     | name          | data type        | polygon              | point                 | line                | deprecated                |
+==============================+===============+==================+======================+=======================+=====================+===========================+
| Base Map                     | `tc_map()`    | geometry         | ![](fig/poly.svg)    | ![](fig/point.svg)    | ![](fig/line.svg)   | \-                        |
+------------------------------+---------------+------------------+----------------------+-----------------------+---------------------+---------------------------+
| Proportional Symbols         | `tc_map_p()`  | stock            | ![](fig/poly_p.svg)  | ![](fig/point_p.svg)  | ![](fig/line_p.svg) | `propSymbolsLayer()`      |
+------------------------------+---------------+------------------+----------------------+-----------------------+---------------------+---------------------------+
| Typology                     | `tc_map_t()`  | category         | ![](fig/poly_t.svg)  | ![](fig/point_t.svg)  | ![](fig/line_t.svg) | `typoLayer()`             |
+------------------------------+---------------+------------------+----------------------+-----------------------+---------------------+---------------------------+
| Choropleth                   | `tc_map_c()`  | ratio            | ![](fig/poly_c.svg)  | ![](fig/point_c.svg)  | ![](fig/line_c.svg) | `choroLayer()`            |
+------------------------------+---------------+------------------+----------------------+-----------------------+---------------------+---------------------------+
| Symbols                      | `tc_map_s()`  | category         | ![](fig/poly_s.svg)  | ![](fig/point_s.svg)  |                     | \-                        |
+------------------------------+---------------+------------------+----------------------+-----------------------+---------------------+---------------------------+
| Graduated Symbols            | `tc_map_g()`  | stock            | ![](fig/poly_g.svg)  | ![](fig/point_g.svg)  | ![](fig/line_g.svg) | \-                        |
+------------------------------+---------------+------------------+----------------------+-----------------------+---------------------+---------------------------+
| Proportional Symbols + Typo  | `tc_map_pt()` | stock & category | ![](fig/poly_pt.svg) | ![](fig/point_pt.svg) |                     | `propSymbolsTypoLayer()`  |
+------------------------------+---------------+------------------+----------------------+-----------------------+---------------------+---------------------------+
| Proportional Symbols + Choro | `tc_map_pc()` | stock & ratio    | ![](fig/poly_pc.svg) | ![](fig/point_pc.svg) |                     | `propSymbolsChoroLayer()` |
+------------------------------+---------------+------------------+----------------------+-----------------------+---------------------+---------------------------+
| Symbols + Choro              | `tc_map_sc()` | category & ratio | ![](fig/poly_sc.svg) | ![](fig/point_sc.svg) |                     | \-                        |
+------------------------------+---------------+------------------+----------------------+-----------------------+---------------------+---------------------------+
| Dot density                  | `tc_map_dd()` | stock            | ![](fig/poly_dd.svg) |                       |                     | `dotDensityLayer()`       |
+------------------------------+---------------+------------------+----------------------+-----------------------+---------------------+---------------------------+
| Discontinuities              | `tc_map_d()`  | stock \| ratio   | ![](fig/poly_d.svg)  |                       |                     | `discLayer()`             |
+------------------------------+---------------+------------------+----------------------+-----------------------+---------------------+---------------------------+

## Map Layout

|                                |
|:------------------------------:|
| ![](fig/deco.svg){width="4in"} |

+-----------------+----------------------+
| name            | deprecated           |
+=================+======================+
| `tc_title()`    | \- / `layoutLayer()` |
+-----------------+----------------------+
| `tc_arrow()`    | `north()`            |
+-----------------+----------------------+
| `tc_credits()`  | \- / `layoutLayer()` |
+-----------------+----------------------+
| `tc_scale()`    | `barscale()`         |
+-----------------+----------------------+
| `tc_layout()`   | `layoutLayer()`      |
+-----------------+----------------------+
| `tc_annotation` | \-                   |
+-----------------+----------------------+
| `tc_label()`    | `labelLayer()`       |
+-----------------+----------------------+



## Themes

`tc_theme()` defines a map theme. It sets the margins of the figure, a background color, a foreground color and some parameters of the title. A set of theme is included in the package and it is possible to create cutom ones.

|                                      |                                         |                                      |
|:------------------------------------:|:---------------------------------------:|:------------------------------------:|
| ![](fig/th_default.svg){width="2in"} | ![](fig/th_agolalight.svg){width="2in"} | ![](fig/th_brutal.svg){width="2in"}  |
|  ![](fig/th_candy.svg){width="192"}  |    ![](fig/th_dark.svg){width="192"}    | ![](fig/th_darkula.svg){width="192"} |
|  ![](fig/th_green.svg){width="192"}  |  ![](fig/th_iceberg.svg){width="192"}   |   ![](fig/th_ink.svg){width="192"}   |
|   ![](fig/th_jsk.svg){width="192"}   | ![](fig/th_nevermind.svg){width="192"}  |                                      |

## Export

The `tc_init()` function can be used to export maps in raster (.png) or vector formats (.svg). 
The size of the exported map will fit the height/width ratio of a spatial object. 

## Datasets

Several datasets are embedded in the package:

-   A [GeoPackage](https://www.geopackage.org/) of Martinique municipalities can be imported with `tc_import_mtq()` (or via `sf::st_read()`).

    -   Sources: [Base comparateur de territoires](https://www.insee.fr/fr/statistiques/2521169) (upload date: 2018-09-25) & [ADMIN EXPRESS-COG](http://professionnels.ign.fr/adminexpress) (2018 edition).

    -   Citation: Insee and IGN, 2018

    -   Fields:

        -   **INSEE_COM**: Municipality identifier
        -   **STATUS**: Municipality administrative status
        -   **LIBGEO**: Municipality name
        -   **POP**: Total population, 2015
        -   **MED**: Median disposable income adjusted per equivalent household member, in euros, 2015
        -   **CHOM**: Unemployed population, 2015
        -   **ACT**: Active population, 2015

-   A csv file of professional mobility flows between Martinique municipalities.

    -   Sources: [Flux de mobilité - déplacements domicile-lieu de travail](https://www.insee.fr/fr/statistiques/3566477) (upload date: 2018-08-01)

    -   Citation: Insee, 2018

    -   Fields:

        -   **i**: Municipality of residence identifier
        -   **j**: Municipality of workplace identifier
        -   **fij**: Flows of workers (employed population, 15 y.o. or more, 2015, only flows \> 100)
        -   **sj**: Administrative status of the workplace municipality
